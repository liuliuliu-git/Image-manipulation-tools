(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/index"],{"07e5":function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return s})),n.d(t,"a",(function(){return o}));var o={uSlider:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u-slider/u-slider")]).then(n.bind(null,"fdcf"))},uButton:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u-button/u-button")]).then(n.bind(null,"eca6"))},uModal:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u-modal/u-modal")]).then(n.bind(null,"c8c8"))},mask:function(){return n.e("components/mask/mask").then(n.bind(null,"7d24"))},llCompressImg:function(){return n.e("uni_modules/ll-compress-img/components/ll-compress-img/ll-compress-img").then(n.bind(null,"e6a2"))}},i=function(){var e=this.$createElement;this._self._c;this._isMounted||(this.e0=function(e){this.modalShow=!1})},s=[]},"2eb8":function(e,t,n){"use strict";n.r(t);var o=n("07e5"),i=n("b9ab");for(var s in i)["default"].indexOf(s)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(s);n("b560");var r=n("828b"),a=Object(r["a"])(i["default"],o["b"],o["c"],!1,null,"4d7a319e",null,!1,o["a"],void 0);t["default"]=a.exports},"3b2c":function(e,t,n){"use strict";(function(e,t){var o=n("47a9");n("2088");o(n("3240"));var i=o(n("2eb8"));e.__webpack_require_UNI_MP_PLUGIN__=n,t(i.default)}).call(this,n("4884")["default"],n("4884")["createPage"])},b560:function(e,t,n){"use strict";var o=n("dca8"),i=n.n(o);i.a},b9ab:function(e,t,n){"use strict";n.r(t);var o=n("bd56"),i=n.n(o);for(var s in o)["default"].indexOf(s)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(s);t["default"]=i.a},bd56:function(e,t,n){"use strict";(function(e){var o=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=o(n("7eb4")),s=o(n("ee10")),r=n("f0fc"),a=(n("38c2"),n("c7a2"),o(n("4ba7"))),l={data:function(){return{imgUrl:"/profile/upload/2024/07/30/19b1f20c48a944e2adf12324a7e2d1d0_20240730140402A013.png",ctx:null,imageUrls:[],allContent:[],transformContent:[],quality:70,dimensions:100,modalShow:!1,maskShow:!1,content:"观看广告，解锁功能",format:"jpg",isClick:!1,title:"压缩图片",mergedContent:[],progressPercent:0,outcome:[],formatNew:1,result:[],rewardAd:null}},components:{mask:function(){n.e("components/mask/mask").then(function(){return resolve(n("7d24"))}.bind(null,n)).catch(n.oe)},myNavbar:function(){Promise.all([n.e("common/vendor"),n.e("components/ms-navbar/index")]).then(function(){return resolve(n("05e0"))}.bind(null,n)).catch(n.oe)},banner:function(){n.e("components/banner/index").then(function(){return resolve(n("bbcf"))}.bind(null,n)).catch(n.oe)}},onLoad:function(){var e=this;return(0,s.default)(i.default.mark((function t(){return i.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$store.dispatch("getAdIds");case 2:e.rewardAd=new a.default(e.getJli,e.customRewardUser);case 3:case"end":return t.stop()}}),t)})))()},computed:{getId:function(){return this.$store.state.bannerId?this.$store.state.bannerId:""},getJli:function(){return this.$store.state.jLiId?this.$store.state.jLiId:""},fullImageUrl:function(){return this.$store.state.baseUrl+this.imgUrl}},methods:{download:function(){e.redirectTo({url:"/pages/index/index"})},cut:function(){e.redirectTo({url:"/pages/modify/modify"})},chooseImageWithPermission:function(){var t=this;e.chooseImage({count:5,sizeType:["original","compressed"],sourceType:["album"],success:function(){var e=(0,s.default)(i.default.mark((function e(n){var o,s,r;return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:o=n.tempFilePaths,t.imageUrls=o,t.maskShow=!0,t.imageUrls=n.tempFilePaths,s=setInterval((function(){t.progressPercent>=130&&(clearInterval(s),t.maskShow=!1,t.progressPercent=0),t.progressPercent+=1}),20),r=t.imageUrls.map((function(e){return t.getImageInfo(e)})),Promise.all(r).then((function(e){t.allContent=e,t.handleParameter()}));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),fail:function(e){console.log(e)}})},ChooseImage:function(){this.chooseImageWithPermission()},confirm:function(){var t=this;return(0,s.default)(i.default.mark((function n(){var o;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t.modalShow=!1,""!=t.imageUrls){n.next=5;break}e.showToast({title:"请先选择图片",duration:2e3,icon:"error"}),n.next=9;break;case 5:return e.showLoading({title:"上传中"}),o=t.mergedContent.map((function(n,o){return new Promise((function(i,s){e.uploadFile({url:t.$store.state.baseUrl+"/ms111/compress/ms111/postImage",filePath:n.url,name:"multipartFiles",formData:{height:n.height,width:n.width},success:function(e){var n=JSON.parse(e.data).msg,s=JSON.stringify(t.mergedContent[o].compressWidth),r=JSON.stringify(t.mergedContent[o].compressHeight),a={file:n,widthpx:s,heightpx:r};t.outcome.push(a),"jpg"==t.format?t.formatNew=1:t.formatNew=2,i()},fail:function(e){console.log(e),s(e)},complete:function(){e.hideLoading()}})}))})),n.next=9,Promise.all(o);case 9:case"end":return n.stop()}}),n)})))()},upload:function(){0==this.imageUrls.length?(e.showToast({title:"请先选择图片",icon:"error",duration:2e3}),this.modalShow=!1):this.rewardAd.init()},jpgClick:function(){this.isClick=!1,this.format="jpg",0==this.allContent.length?e.showToast({title:"请先选择图片",duration:2e3,icon:"error"}):this.handleParameter()},pngClick:function(){this.isClick=!0,this.format="png",0==this.allContent.length?(e.showToast({title:"请先选择图片",duration:2e3,icon:"error"}),this.isClick=!1,this.format="jpg"):this.handleParameter()},Compress:function(){this.modalShow=!0},getImageInfo:function(t){return new Promise((function(n,o){var i={url:t,width:0,height:0};e.getFileInfo({filePath:t,success:function(s){i.size=Math.ceil(s.size/1024*10)/10,e.getImageInfo({src:t,success:function(e){i.width=e.width,i.height=e.height,n(i)},fail:function(e){o(e)}})},fail:function(e){o(e)}})}))},handleParameter:function(){var t=this;1==this.maskShow||0!=this.allContent.length&&e.showLoading({title:"重新计算信息中"}),this.mergedContent=[];for(var n=function(n){e.compressImage({src:t.allContent[n].url,quality:t.quality,compressedWidth:t.allContent[n].width*(t.dimensions/100),compressedHeight:t.allContent[n].height*(t.dimensions/100),success:function(o){e.getFileInfo({filePath:o.tempFilePath,success:function(e){var o={url:"",width:0,height:0,size:0,compressWidth:0,compressHeight:0,compressSize:0};o.compressWidth=Math.ceil(t.allContent[n].width*(t.dimensions/100)),o.compressHeight=Math.ceil(t.allContent[n].height*(t.dimensions/100)),o.compressSize=Math.ceil(e.size/1024*10)/10,o.width=t.allContent[n].width,o.size=t.allContent[n].size,o.height=t.allContent[n].height,o.url=t.allContent[n].url,t.mergedContent.push(o)},fail:function(e){console.log(e)}})},fail:function(e){console.log(e)}})},o=0;o<this.allContent.length;o++)n(o);e.hideLoading()},putQualityApi:function(t){var n=this;(0,r.putQuality)(t).then((function(t){console.log(t,111),n.result=t.data;for(var o=function(t){e.downloadFile({url:n.$store.state.baseUrl+n.result[t],success:function(e){console.log(e);var o=e.tempFilePath;200==e.statusCode&&n.getSet(o,n.result[t])},fail:function(e){console.log(e)}})},i=0;i<n.result.length;i++)o(i)})).catch((function(e){console.log(e)})),this.result=[]},deleteImageApi:function(e){(0,r.deleteImage)(e).then((function(e){console.log(e)})).catch((function(e){console.log(e,111)}))},saveImage:function(t,n){var o=this;console.log(333),e.saveImageToPhotosAlbum({filePath:t,success:function(t){console.log(t,"save"),o.deleteImageApi(n),e.hideLoading(),e.showToast({title:"保存成功！",duration:2e3})},fail:function(t){console.log(t.errMsg),e.showToast({title:"请重新保存",icon:"error",duration:2e3})},complete:function(t){console.log(t),e.hideLoading()}})},getSet:function(t,n){var o=this;e.getSetting({success:function(i){i.authSetting["scope.writePhotosAlbum"]?(console.log(222),console.log(t,n),o.saveImage(t,n)):e.authorize({scope:"scope.writePhotosAlbum",success:function(){o.saveImage(t,n)},fail:function(){e.hideLoading(),e.showModal({title:"您已拒绝获取相册权限",content:"是否进入权限管理，调整授权？",success:function(t){if(t.confirm)e.openSetting({success:function(e){console.log(e.authSetting)}});else if(t.cancel)return e.showToast({title:"已取消！",icon:"error",duration:2e3})}})}})},fail:function(e){console.log(e)}})},customRewardUser:function(){var t=this;return(0,s.default)(i.default.mark((function n(){return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.confirm();case 2:t.putQualityApi(JSON.stringify({qualitySizes:t.outcome,format:t.formatNew,quality:t.quality/100})),e.showLoading({title:"正在保存图片..."}),t.outcome=[];case 5:case"end":return n.stop()}}),n)})))()}},onUnload:function(){this.rewardAd.destroyAllAd()}};t.default=l}).call(this,n("4884")["default"])},dca8:function(e,t,n){}},[["3b2c","common/runtime","common/vendor"]]]);