(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/sub-modify/modifyDpi/modifyDpi"],{"2eb7":function(e,t,n){"use strict";var o=n("3948"),i=n.n(o);i.a},3948:function(e,t,n){},5161:function(e,t,n){"use strict";(function(e){var o=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=o(n("7eb4")),a=o(n("ee10")),s=n("f0fc"),r=n("c7a2"),u=o(n("4ba7")),c={data:function(){return{imgUrl:"/profile/upload/2024/07/30/19b1f20c48a944e2adf12324a7e2d1d0_20240730140402A013.png",imageUrls:[],dpi:150,max_input:300,maskShow:!1,allContent:[],modalShow:!1,title:"修改dpi",content:"观看广告，解锁功能",outcome:[],result:[],loading:!0,progressPercent:0,rewardAd:null}},components:{mask:function(){n.e("components/mask/mask").then(function(){return resolve(n("7d24"))}.bind(null,n)).catch(n.oe)},banner:function(){n.e("components/banner/index").then(function(){return resolve(n("bbcf"))}.bind(null,n)).catch(n.oe)}},onLoad:function(){this.rewardAd=new u.default(this.getJli,this.customRewardUser)},computed:{getId:function(){return this.$store.state.bannerId?this.$store.state.bannerId:""},getJli:function(){return this.$store.state.jLiId?this.$store.state.jLiId:""},fullImageUrl:function(){return this.$store.state.baseUrl+this.imgUrl}},methods:{change:function(e){this.dpi=e.detail.value},ChooseImage:function(){var t=this;this.imageUrls=[],this.allContent=[],e.chooseImage({count:5,sizeType:["original","compressed"],sourceType:["album"],success:function(){var n=(0,a.default)(i.default.mark((function n(o){var a,s,u,c,l;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:a=o.tempFilePaths,t.imageUrls=a,s=i.default.mark((function n(a){return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,(0,r.verifyImage)(t.$store.state.ttAppid,o.tempFilePaths[a],t.$store.state.clientType).then((function(n){n&&(t.imageUrls.splice(a,1),e.showToast({title:"图片存在风险,请重新上传",duration:2e3,icon:"fail"}))})).catch((function(e){console.log(e)}));case 2:case"end":return n.stop()}}),n)})),u=0;case 4:if(!(u<o.tempFilePaths.length)){n.next=9;break}return n.delegateYield(s(u),"t0",6);case 6:u++,n.next=4;break;case 9:t.maskShow=!0,c=setInterval((function(){t.progressPercent>=130&&(clearInterval(c),t.maskShow=!1,t.progressPercent=0),t.progressPercent+=1}),20),l=t.imageUrls.map((function(e){return t.getImageInfo(e)})),Promise.all(l).then((function(e){t.allContent=e}));case 13:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()})},uploadImages:function(t){var n=this;return(0,a.default)(i.default.mark((function o(){var a,s,r,u;return i.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:a=[],e.showLoading({title:"上传中"}),s=0;case 3:if(!(s<t.length)){o.next=17;break}return o.prev=4,o.next=7,e.uploadFile({url:n.$store.state.baseUrl+"/ms111/compress/ms111/postImage",filePath:t[s],name:"multipartFiles",formData:{width:n.allContent[s].width,height:n.allContent[s].height}});case 7:r=o.sent,200==r.statusCode&&(u={fileImage:JSON.parse(r.data).msg,heightpx:n.allContent[s].height,widthpx:n.allContent[s].width},a.push(u)),o.next=14;break;case 11:o.prev=11,o.t0=o["catch"](4),console.log("上传失败:",o.t0);case 14:s++,o.next=3;break;case 17:return e.hideLoading(),o.abrupt("return",a);case 19:case"end":return o.stop()}}),o,null,[[4,11]])})))()},ModifyImage:function(){this.modalShow=!0},getImageInfo:function(t){return new Promise((function(n,o){var i={url:t,size:0,width:0,height:0};e.getFileInfo({filePath:t,success:function(a){i.size=Math.ceil(a.size/1024*10)/10,e.getImageInfo({src:t,success:function(e){i.width=e.width,i.height=e.height,n(i)},fail:function(e){o(e)}})},fail:function(e){o(e)}})}))},confirm:function(){""==this.imageUrls?e.showToast({title:"请先选择图片",icon:"error",duration:2e3}):this.rewardAd.init(),this.modalShow=!1},putDpiApi:function(t){var n=this;(0,s.putDpi)(t).then((function(t){if(200==t.code){n.result=t.data;for(var o=function(t){e.downloadFile({url:n.$store.state.baseUrl+n.result[t],success:function(e){var o=e.tempFilePath;200==e.statusCode&&n.getSet(o,n.result[t])},fail:function(e){console.log(e)}})},i=0;i<n.result.length;i++)o(i)}})).catch((function(e){console.log(e)})),this.result=[]},deleteImageApi:function(e){(0,s.deleteImage)(e).then((function(e){})).catch((function(e){console.log(e,111)}))},saveImage:function(t,n){var o=this;e.saveImageToPhotosAlbum({filePath:t,success:function(t){return o.deleteImageApi(n),e.hideLoading(),e.showToast({title:"保存成功！",duration:2e3})},fail:function(t){return console.log(t.errMsg),e.showToast({title:"请重新保存",icon:"error",duration:2e3})},complete:function(t){e.hideLoading()}})},getSet:function(t,n){var o=this;e.getSetting({success:function(i){i.authSetting["scope.album"]?o.saveImage(t,n):e.authorize({scope:"scope.album",success:function(){o.saveImage(t,n)},fail:function(){e.hideLoading(),e.showModal({title:"您已拒绝获取相册权限",content:"是否进入权限管理，调整授权？",success:function(t){if(t.confirm)e.openSetting({success:function(e){console.log(e.authSetting)}});else if(t.cancel)return e.showToast({title:"已取消！",icon:"error",duration:2e3})}})}})},fail:function(e){console.log(e)}})},customRewardUser:function(){var t=this;return(0,a.default)(i.default.mark((function n(){return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.uploadImages(t.imageUrls);case 2:t.outcome=n.sent,t.putDpiApi(JSON.stringify({dpi:t.dpi,files:t.outcome})),e.showLoading({title:"正在保存图片..."}),t.outcome=[];case 6:case"end":return n.stop()}}),n)})))()}},onUnload:function(){this.rewardAd.destroyAllAd()}};t.default=c}).call(this,n("a261")["default"])},"9dc9":function(e,t,n){"use strict";(function(e,t){var o=n("47a9");n("2088");o(n("3240"));var i=o(n("efed"));e.__webpack_require_UNI_MP_PLUGIN__=n,t(i.default)}).call(this,n("a261")["default"],n("a261")["createPage"])},a917:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return o}));var o={uButton:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u-button/u-button")]).then(n.bind(null,"eca6"))},uModal:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u-modal/u-modal")]).then(n.bind(null,"c8c8"))},mask:function(){return n.e("components/mask/mask").then(n.bind(null,"7d24"))}},i=function(){var e=this.$createElement;this._self._c;this._isMounted||(this.e0=function(e){this.modalShow=!1})},a=[]},d4ae:function(e,t,n){"use strict";n.r(t);var o=n("5161"),i=n.n(o);for(var a in o)["default"].indexOf(a)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(a);t["default"]=i.a},efed:function(e,t,n){"use strict";n.r(t);var o=n("a917"),i=n("d4ae");for(var a in i)["default"].indexOf(a)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(a);n("2eb7");var s=n("828b"),r=Object(s["a"])(i["default"],o["b"],o["c"],!1,null,"dfaf151c",null,!1,o["a"],void 0);t["default"]=r.exports}},[["9dc9","common/runtime","common/vendor"]]]);